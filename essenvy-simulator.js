window.onload=function() {
var site_root = "http://flo.binera.fr/ess-envy-simulator";

var price_list = {
    "bare" : 10.90,
    "beam" : 11.40,
    "brilliance" : 11.90
};

var color_list = {
    "sahara": "url(" + site_root + "textures/sahara.jpg)",
    "caramel": "url(" + site_root + "textures/caramel.jpg)",
    "chocolate": "url(" + site_root + "textures/chocolate.jpg)",
    "white": "url(" + site_root + "textures/white.jpg)",
    "flesh light": "url(" + site_root + "textures/flesh-light.jpg)",
    "peach": "url(" + site_root + "textures/peach.jpg)",
    "sunflower": "url(" + site_root + "textures/sunflower.jpg)",
    "tangerine": "url(" + site_root + "textures/tangerine.jpg)",
    "indian red": "url(" + site_root + "textures/indian-red.jpg)",
    "cherry red": "url(" + site_root + "textures/cherry-red.jpg)",
    "lavender": "url(" + site_root + "textures/lavender.jpg)",
    "plum": "url(" + site_root + "textures/plum.jpg)",
    "purple": "url(" + site_root + "textures/purple.jpg)",
    "black": "url(" + site_root + "textures/black.jpg)",
    "peppermint": "url(" + site_root + "textures/peppermint.jpg)",
    "brilliant blue": "url(" + site_root + "textures/brilliant-blue.jpg)",
    "navy blue": "url(" + site_root + "textures/navy-blue.jpg)",
    "emerald": "url(" + site_root + "textures/emerald.jpg)",
    "leaf green": "url(" + site_root + "textures/leaf-green.jpg)",
    "burgundy": "url(" + site_root + "textures/burgundy.jpg)",
    "metallic gold": "url(" + site_root + "textures/metallic-gold.jpg)",
    "glitter blue": "url(" + site_root + "textures/glitter-blue.jpg)",
    "glitter white": "url(" + site_root + "textures/glitter-white.jpg)",
    "opal green": "url(" + site_root + "textures/opal-green.jpg)",
    "silver": "url(" + site_root + "textures/silver.jpg)"
};

var color_names = [];
for(color in color_list)
    color_names.push(color);
color_names.sort();

var R = Raphael('simulator', 500, 500);
var attr = {
    "stroke": "none"
};

var elem0 = R.ellipse(161, 143, 88, 110);
var elem1 = R.path("m 180.56549,52.344526 c -0.745,4.241612 -4.96515,4.150384 -6.94044,5.874224 -2.06671,1.886623 -4.5777,6.027965 1,7 3.39932,0.361409 7.79358,2.767856 8.53125,4.53125 2.12912,1.29793 3.88152,3.525084 4,7.058151 -0.24445,4.804845 1.46829,8.820917 1,13.719559 0.0176,3.810572 -0.0817,8.564294 1.5,10.81604 0.93248,2.1039 3.59712,4.75304 5.53125,6.03125 4.5946,1.10775 8.3258,1.64169 11.03125,3 1.63137,2.15337 4.78141,2.25998 7.03125,4.03125 6.41827,0.61963 11.3188,3.03648 18.0625,3.5 2.35325,1.08017 6.63983,0.22701 9.80026,0.5 4.94496,1.35589 4.89018,-1.9654 4.25869,-6.20437 -0.69307,-4.436 -2.15963,-8.15568 -3,-11.9818 -1.48185,-1.86848 -1.9041,-3.682406 -3.0277,-5.37633 -0.75382,-2.071189 -6.79745,-1.744792 -9.84408,-2.368237 -4.46773,-0.933172 -9.1715,-1.476871 -12.6806,-3.813536 -2.31376,-0.114639 -4.89268,-2.173475 -6.56907,-3.349477 -1.03306,-3.198623 -1.21426,-7.455509 -3.40226,-9.909353 -0.84444,-4.628873 -2.96965,-8.793289 -5.12899,-12.184397 -3.36726,-3.030416 -2.61489,-5.147646 -6.53125,-7.03125 -0.2893,-1.993216 -5.05211,-1.627942 -8.30483,-2.717753 -2.42459,-0.361769 -3.70178,-0.327518 -6.31723,-1.125221 z M 168.5313,72.21875 c -3.46536,0.951511 -6.98575,0.09931 -9.51407,1.91491 -2.53927,0.294699 -4.51297,2.612955 -6.98593,3.64759 -1.58302,1.452355 -4.17465,3.526715 -6,5 -3.5268,1.465398 -6.72857,2.653716 -9.5625,5.53125 -1.51417,1.998204 -4.54547,3.917008 -6.00223,5.675027 -0.86914,0.547105 -3.66969,2.921631 -5.02902,4.356223 -3.9823,1.204191 -8.1775,2.92511 -12.78125,3.53125 -4.36809,0.65982 -7.21204,2.75783 -11.54688,3.5 -3.757437,0.6046 -7.679316,0.81513 -10.29687,2.5 -2.532049,3.49413 -5.34869,4.40756 -7.963146,7.16102 -2.284893,2.02326 -3.599692,0.60871 -6.584313,4.21332 -1.440973,4.92186 -1.268633,8.49071 -1.884279,12.22118 2.157741,1.5254 4.314502,-0.66159 6.454291,-1.00177 4.374397,0.50884 7.961074,-1.01497 10.477447,-2.53125 2.947602,-1.48116 8.524808,-1.61856 10.57037,-3.4674 1.60209,-1.35416 4.47303,-2.56679 6.49213,-4.0326 2.97331,-1.58956 4.89266,-2.73046 6.53125,-4.53125 3.41853,-0.6864 6.40071,-2.26735 8.03125,-3.5 2.28577,-1.98694 5.54673,-3.39941 8.03125,-4.53125 1.56769,-0.50253 4.14095,-3.26383 5,-3 1.98843,-3.65495 6.29979,-4.28302 9.03125,-7.03125 3.16608,-1.201466 4.20653,-3.178004 6.53125,-5.03125 2.46503,-1.476368 3.46808,-2.053303 4.87887,-4.74852 1.10876,-0.815064 1.86352,-3.708996 4.15238,-5.28273 2.83761,-0.999736 7.42695,-0.27065 11.03125,-0.5 2.13718,2.552621 0.51963,7.669796 1.03976,11.377067 -0.17688,2.964091 -3.5756,5.36933 -5.08902,6.372323 -2.773,2.06033 -4.57506,2.95875 -5.48961,6.67049 -2.32189,0.69927 -0.86743,6.63213 1.00762,7.70512 4.27824,0.60116 6.90562,-0.44855 7.53125,-3.5 1.06031,-2.19461 2.99893,-5.59534 4.03125,-8.03125 2.03344,-2.60669 3.59909,-4.158963 5,-6.53125 0.9591,-4.588634 0.31066,-10.784805 0.5,-16.143204 0.0127,-3.338547 0.34469,-6.996319 -2.0269,-7.950546 -3.18876,-0.01828 -6.37888,0.03853 -9.56685,-0.03125 z M 179.75,99.8125 c -0.27892,7.52309 -0.0509,15.442 -0.125,23.125 1.70968,4.42407 3.37297,8.23442 3.53125,13.53125 -0.0126,4.49687 -0.28433,8.48807 1.5,12.0625 0,6.52083 0,13.04167 0,19.5625 -1.24515,1.97713 -3.14163,4.45198 -4.53125,5.03125 -2.21223,1.61857 -3.13185,2.80249 -5.0326,5.4765 -0.5778,3.2269 -0.66349,6.90629 -2.4674,8.55475 -1.98295,0.77591 -2.97226,3.4081 -4.53125,5.53125 -1.13077,3.78494 -3.45439,7.01475 -5.03125,10.03125 -2.77,3.35126 -4.05871,6.76527 -5,11.53125 -1.94784,3.85595 -5.31169,6.09022 -8.53125,9.53125 -2.49899,2.48421 -4.47035,7.03972 -8.03125,9.53125 -2.75987,3.09151 -6.4767,3.16301 -7.53125,7.03125 -2.1856,4.05708 -1.11177,7.51749 4.10761,6.03125 4.58544,0.3593 6.74502,-4.18386 9.45489,-7.03125 2.37959,-3.25237 6.05418,-3.94656 9.28125,-5.03125 3.71132,-0.31593 4.7973,-3.91398 7.78125,-6.5 2.39291,-1.672 5.43552,-1.60589 9.13451,-1.5 3.20406,0.0614 6.65976,0.37443 7.39674,-2.03125 1.57112,-0.84252 3.35938,-7.79215 3.53125,-2.89239 0.22408,3.2953 -1.38478,8.42354 3.63451,6.92364 5.04272,-0.0659 8.06355,-0.75569 11.92799,-3.03125 2.44408,-0.75845 2.01446,-4.39061 2,-7.60761 0.118,-4.33845 -0.34548,-8.91776 0.5,-12.95489 0.96482,-2.67624 5.71352,-1.06842 8.53125,-1.5 3.7156,1.8036 5.60611,1.26323 8.90581,4.27682 4.76824,1.37929 10.84852,5.58669 12.28213,0.7285 1.2699,-2.86732 2.76894,-5.01732 4.40404,-8.50621 1.68195,-3.0218 3.29697,-7.16471 4.25088,-10.03213 1.61078,-4.67322 2.7371,-9.5994 4.5348,-14.68529 0.73892,-4.35027 2.71673,-8.44063 2.3781,-13.24085 0.11062,-3.65603 2.15778,-4.94405 -1.13076,-6.69709 -3.28124,-1.78728 -5.37304,-1.84973 -8.53125,-3.53125 -3.60455,-0.92288 -6.23545,-1.71916 -9.03125,-4.5 -2.60856,-2.31129 -5.28056,-4.11015 -7.53125,-6.03125 -3.09735,-1.62388 -6.22703,-4.48025 -8.53125,-6.0312 -2.81131,-1.90568 -5.59925,-4.57405 -7.53125,-7.03125 -4.30883,-3.30966 -4.22318,-6.34859 -7.71711,-10.03218 -2.32856,-3.73887 -4.86094,-2.9443 -7.31414,-6.49902 -3.62039,-1.90794 -2.64092,-5.33286 -5.53125,-8.03125 -0.62337,-1.54981 -2.81862,-4.00169 -5.40625,-3.5626 z M 133.46875,246.375 c -0.12063,-0.11847 -0.87561,0.20013 0,0 z m 61.4375,-83.875 c 0.62344,6.12414 0.11273,13.16966 0.28125,19.65625 -2.18545,4.50591 -2.48642,8.61505 -3.4674,14.55475 -0.85909,3.73891 -1.64102,8.47221 -3.56385,12.039 -1.84889,2.41703 -2.79942,8.07763 -2.5,1.28479 0.0416,-5.48982 1.9821,-9.30459 2.5,-14.59729 1.54092,-2.32652 0.37336,-6.81257 2.0312,-8.78125 -0.35101,-4.98313 1.33106,-9.29263 1,-14.21956 -0.0355,-3.52491 1.66397,-5.06886 2.86804,-8.38826 0.5377,-0.0461 -0.49807,-1.79201 0.85076,-1.54843 z m -57.28347,47.06383 c -5.19467,-0.3852 -8.03449,0.17484 -11.18528,2.68612 -3.48783,2.45577 -6.22368,5.42745 -10.03125,7.03125 -2.86569,1.12002 -4.24102,3.70925 -7.53125,5.5 -0.88951,2.47496 -0.86835,1.65093 -0.62367,5.31475 1.44622,1.90047 4.37416,5.17381 6.31633,6.24775 3.87908,-1.15342 8.31951,-0.10051 9.86984,-1.5 1.61003,-1.05787 4.64925,-2.63086 6.03125,-4.03125 3.68324,-0.68114 3.76319,-4.34678 5,-8.03125 0.64471,-3.48027 2.53147,-6.43374 3.03125,-9.58505 -0.181,-1.13753 -0.27627,-2.89024 -0.87722,-3.63232 z").attr(attr);

var elem2 = R.path("m 147.9703,34.381206 c -6.68175,0.862287 -13.28592,3.954606 -19.71919,6.970412 -0.74502,4.282573 -4.16476,5.607599 -6.57977,9.102043 -4.84196,4.406397 -8.67053,10.220653 -15.0986,12.423537 -3.00006,2.900217 -3.58336,2.052151 -5.16951,0.317949 -7.304787,8.494388 -13.467966,18.549614 -17.618434,29.36824 6.623327,-0.312872 12.521638,0.84496 18.714284,-2.129974 6.56605,-2.476626 13.84862,-3.516168 19.25717,-8.314391 5.35438,-4.017717 11.47027,-7.278877 16.35351,-11.764677 2.50182,-4.087795 5.71535,-7.935296 7.61196,-12.174169 0.92037,-4.413894 -3.64741,-9.329559 -0.75131,-13.273039 5.62214,-3.83128 11.36496,-5.057813 17.0625,-6.03125 0.78736,-2.681469 2.18024,-3.770279 -0.68794,-5.686392 -4.43731,0 -8.84327,0.470412 -13.37467,1.191711 z m 38.99779,3.402371 c -2.17708,5.020833 -4.16601,9.38309 -6.34309,14.403923 5.02083,0.452271 10.04167,1.37791 15.0625,3 4.91058,4.969128 7.55499,10.341314 9.96736,16.128169 1.53171,5.498944 4.44331,9.994341 5.97502,15.493285 9.11477,4.092784 18.44365,5.860624 28.21742,6.658466 -1.16464,-2.342676 -2.14262,-4.600522 -3.2313,-6.993596 -2.66196,-5.851382 -6.36474,-11.51038 -9.52955,-17.0281 -6.14013,-6.628447 -11.9868,-13.622227 -18.3074,-20.026006 -6.58431,-4.817425 -14.14484,-8.066968 -21.81096,-11.636141 z M 159.0625,99.34375 c -10.30665,3.92488 -22.44854,14.07412 -31.96852,23.51643 -9.96213,9.0825 -23.16558,21.26334 -30.020447,27.64063 -7.045052,10.49467 -11.822123,20.24167 -17.53785,31.40101 1.936315,7.56096 5.364778,15.9604 9.280363,23.19149 10.84836,-1.48018 20.849764,-2.33715 31.600554,-4.12746 4.75484,-2.54518 9.93586,-4.53547 13.09934,-9.15259 4.82131,-6.46361 10.17724,-13.11923 15.59013,-17.56996 3.77461,-4.78879 6.71905,-12.14095 10.70589,-18.61813 5.2428,-8.51765 10.43776,-16.29844 9.78002,-18.12517 -0.7437,-5.1875 -1.81024,-16.01995 -4.49823,-15.5625 -7.41359,8.91209 -11.16609,17.65012 -14.85977,27.4593 -2.46428,5.1134 -4.34421,10.695 -7.1695,15.51917 -7.74479,5.57055 -15.26039,11.60897 -23.14852,16.8869 -10.53449,2.96154 -21.068973,5.92309 -31.60346,8.88463 -0.01716,-3.21845 -1.3711,-7.03017 -0.562638,-9.88221 6.708379,-4.90385 13.416758,-9.80769 20.125138,-14.71154 1.48512,-6.17214 4.91163,-17.29379 9.68685,-21.54092 6.74127,-8.18496 11.93178,-13.43309 18.85783,-21.4156 4.44915,-3.32739 9.78241,-5.79103 13.69095,-9.64658 2.98395,-4.71564 10.23298,-10.05849 8.95187,-14.1469 z M 212.25,125.4375 c 0.32935,3.21809 13.20301,13.83732 22.0625,19.0625 4.56383,1.08776 12.76551,0.29389 14.82048,-1.00177 1.17199,-5.7305 -0.54123,-10.83378 -0.87456,-16.18795 -11.20833,-0.83333 -36.46631,-3.67376 -36.00842,-1.87278 z m -6.53125,29.09375 c 0.88685,2.72369 9.23433,5.91229 12.5625,10.0625 -1.10367,4.17133 -8.81191,2.94664 -11.05718,9.0348 -0.54774,6.49199 -0.37633,7.09973 -1.50532,11.5277 1.01774,8.9186 5.48908,6.78792 6.85809,4.9982 1.05772,-3.34315 -0.26798,-5.8082 2.92227,-9.15135 3.14155,-2.24966 17.68474,0.53894 21.59198,0.15138 2.3391,-1.09065 -6.10993,-18.61437 -14.80984,-23.09198 -5.01906,-2.18063 -17.43928,-5.99202 -16.5625,-3.53125 z m 3.25975,71.53036 c -14.38542,1.10496 -34.54122,4.12492 -44.91245,8.53125 -1.30156,3.61133 0.49519,5.6822 4.84867,6.08748 9.2576,0.72114 18.38975,0.9405 27.52189,0.78353 4.86737,0.45197 7.99878,-2.08727 11.28214,-5.12012 -0.5,-3.34375 1.75975,-6.93839 1.25975,-10.28214 z").attr(attr);

var elems = [elem0, elem1, elem2];
for(i=0;i<elems.length;i++)
    elems[i].transform("t-30,80").attr({opacity:1});

var shadow = R.image(site_root + "/mask.png", 43,113,178,220).attr({opacity:0.3}).toFront();

var selected = [];
for(var c = 0; c < 3; c++) {
    var rects = [];
    for(var i = 0; i < color_names.length; i++) {
        var color = color_list[color_names[i]];
        var rect = R.rect(350+c*30, 20+i*17, 15, 15, 3).attr({"stroke": "#000", "stroke-width": 1, fill: color, cursor: "pointer"});
        rect.elem = elems[c];
        rect.color = color;
        rect.c = c;
        rect.click(function() {
                rect_selected(this);
            })
            .mouseover(function () {
                this.attr({"stroke-width": 4});
                if(this.color[0] != '#')
                    this.elem.stop().attr({fill: this.color});
                else
                    this.elem.animate({fill: this.color}, 100);
            })
            .mouseout(function () {
                if (selected[this.c] != this)
                    this.attr({"stroke-width": 1});
                if(selected[this.c].color[0] != '#')
                    this.elem.stop().attr({fill:selected[this.c].color});
                else
                    this.elem.stop().animate({fill:selected[this.c].color}, 100);
            });
        rects.push(rect);
        
        if (c == 0)
            R.text(300, 27 + i*17, color_names[i]);
    }
    selected[c] = rects[Math.round(Math.random()*24,0)];
    rect_selected(selected[c]);
}

Raphael.fn.checkbox = function(x, y, sx, sy, onFunc, offFunc) {
    var toggled = true;
    var c = R.set();
    var sx2 = sx/2-2; var sy2 = sy/2-2;
    var path = Raphael.format("M-{0},-{1}L{0},{1}M-{0},{1}L{0},-{1}", sx2, sy2);
    var box = R.rect(x, y, sx, sy).attr({fill:"#fff"});
    var tick = R.path(path).translate(x+(sx/2),y+(sy/2)).toFront();
    c.push(tick, box);
    c.click(function() {
    toggled = !toggled;
    if (toggled)
    {
        tick.show();
        onFunc(this);
    }
    else
    {
        tick.hide();
        offFunc(this);
    }
}).attr({cursor:"pointer"});
    return c;
};
    
R.text(378, 456, "Third color?");

var cover = R.rect(408, 10, 30, 435).attr({opacity:0.7,fill:"#fff", stroke:"none"}).hide();
var checkbox = R.checkbox(414, 450, 10, 10, 
                          function() {cover.hide();elem2.show();},
                          function() {cover.show();elem2.hide();});

function rect_selected(rect)
{
    rect.elem.attr({fill: rect.color});
    if(selected[rect.c])
        selected[rect.c].attr({"stroke-width": 1});
    selected[rect.c] = rect;
    rect.attr({"stroke-width": 4});
}

}
